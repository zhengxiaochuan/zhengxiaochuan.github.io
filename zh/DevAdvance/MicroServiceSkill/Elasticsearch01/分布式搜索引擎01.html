<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>分布式搜索引擎01 | 狸猫小僧</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="记录点滴足迹  保留美好时光">
    
    <link rel="preload" href="/assets/css/0.styles.89e32c3d.css" as="style"><link rel="preload" href="/assets/js/app.a0a6ba19.js" as="script"><link rel="preload" href="/assets/js/4.900969d6.js" as="script"><link rel="preload" href="/assets/js/201.035e7d0f.js" as="script"><link rel="prefetch" href="/assets/js/10.ae841844.js"><link rel="prefetch" href="/assets/js/100.cf6ce137.js"><link rel="prefetch" href="/assets/js/101.f2abc0db.js"><link rel="prefetch" href="/assets/js/102.9f6abd59.js"><link rel="prefetch" href="/assets/js/103.7cf21ae7.js"><link rel="prefetch" href="/assets/js/104.d728bb9e.js"><link rel="prefetch" href="/assets/js/105.7bebd55a.js"><link rel="prefetch" href="/assets/js/106.ddab0467.js"><link rel="prefetch" href="/assets/js/107.8028f314.js"><link rel="prefetch" href="/assets/js/108.d53240b9.js"><link rel="prefetch" href="/assets/js/109.d8c35d05.js"><link rel="prefetch" href="/assets/js/11.d83444e5.js"><link rel="prefetch" href="/assets/js/110.8ea13ab8.js"><link rel="prefetch" href="/assets/js/111.ac258290.js"><link rel="prefetch" href="/assets/js/112.76954b52.js"><link rel="prefetch" href="/assets/js/113.cb552822.js"><link rel="prefetch" href="/assets/js/114.1ae98173.js"><link rel="prefetch" href="/assets/js/115.bd9db7c3.js"><link rel="prefetch" href="/assets/js/116.e90fe935.js"><link rel="prefetch" href="/assets/js/117.74b2b9d3.js"><link rel="prefetch" href="/assets/js/118.9d95855c.js"><link rel="prefetch" href="/assets/js/119.f20f4910.js"><link rel="prefetch" href="/assets/js/12.a95007f6.js"><link rel="prefetch" href="/assets/js/120.0e42bc53.js"><link rel="prefetch" href="/assets/js/121.9e9a8407.js"><link rel="prefetch" href="/assets/js/122.d65f265c.js"><link rel="prefetch" href="/assets/js/123.bb3becda.js"><link rel="prefetch" href="/assets/js/124.0283a8a5.js"><link rel="prefetch" href="/assets/js/125.78ff793a.js"><link rel="prefetch" href="/assets/js/126.f05f3a81.js"><link rel="prefetch" href="/assets/js/127.8fafb83a.js"><link rel="prefetch" href="/assets/js/128.d2274614.js"><link rel="prefetch" href="/assets/js/129.31b34bcf.js"><link rel="prefetch" href="/assets/js/13.adde881c.js"><link rel="prefetch" href="/assets/js/130.0de256fa.js"><link rel="prefetch" href="/assets/js/131.1c848215.js"><link rel="prefetch" href="/assets/js/132.66cb9630.js"><link rel="prefetch" href="/assets/js/133.ae365087.js"><link rel="prefetch" href="/assets/js/134.df89864d.js"><link rel="prefetch" href="/assets/js/135.52b32953.js"><link rel="prefetch" href="/assets/js/136.03ddb112.js"><link rel="prefetch" href="/assets/js/137.e7d3a40f.js"><link rel="prefetch" href="/assets/js/138.3dd861eb.js"><link rel="prefetch" href="/assets/js/139.6cd3eb99.js"><link rel="prefetch" href="/assets/js/14.99a7c0d0.js"><link rel="prefetch" href="/assets/js/140.e6cba4ab.js"><link rel="prefetch" href="/assets/js/141.99270a16.js"><link rel="prefetch" href="/assets/js/142.51e28975.js"><link rel="prefetch" href="/assets/js/143.c98ad84e.js"><link rel="prefetch" href="/assets/js/144.a322dc59.js"><link rel="prefetch" href="/assets/js/145.5be21de8.js"><link rel="prefetch" href="/assets/js/146.af2f0281.js"><link rel="prefetch" href="/assets/js/147.001e6965.js"><link rel="prefetch" href="/assets/js/148.d3b31aca.js"><link rel="prefetch" href="/assets/js/149.6696516a.js"><link rel="prefetch" href="/assets/js/15.7281e3ec.js"><link rel="prefetch" href="/assets/js/150.c8c0c607.js"><link rel="prefetch" href="/assets/js/151.3d845b77.js"><link rel="prefetch" href="/assets/js/152.cc1d38e6.js"><link rel="prefetch" href="/assets/js/153.468ba5e3.js"><link rel="prefetch" href="/assets/js/154.695fc643.js"><link rel="prefetch" href="/assets/js/155.aef69d2d.js"><link rel="prefetch" href="/assets/js/156.fb87552c.js"><link rel="prefetch" href="/assets/js/157.4faf63ac.js"><link rel="prefetch" href="/assets/js/158.0eb7a1d9.js"><link rel="prefetch" href="/assets/js/159.bfed5640.js"><link rel="prefetch" href="/assets/js/16.692525a7.js"><link rel="prefetch" href="/assets/js/160.a01cb758.js"><link rel="prefetch" href="/assets/js/161.5ed4add8.js"><link rel="prefetch" href="/assets/js/162.005bff4e.js"><link rel="prefetch" href="/assets/js/163.a4d17d39.js"><link rel="prefetch" href="/assets/js/164.ecde4171.js"><link rel="prefetch" href="/assets/js/165.7b51e810.js"><link rel="prefetch" href="/assets/js/166.36073240.js"><link rel="prefetch" href="/assets/js/167.115724ca.js"><link rel="prefetch" href="/assets/js/168.e2f2d65a.js"><link rel="prefetch" href="/assets/js/169.c7cc5517.js"><link rel="prefetch" href="/assets/js/17.7f594766.js"><link rel="prefetch" href="/assets/js/170.16387b67.js"><link rel="prefetch" href="/assets/js/171.02fda3e1.js"><link rel="prefetch" href="/assets/js/172.db7af819.js"><link rel="prefetch" href="/assets/js/173.0e8b680b.js"><link rel="prefetch" href="/assets/js/174.a64d5958.js"><link rel="prefetch" href="/assets/js/175.b2d103c6.js"><link rel="prefetch" href="/assets/js/176.d0073544.js"><link rel="prefetch" href="/assets/js/177.6e931245.js"><link rel="prefetch" href="/assets/js/178.6d7907c2.js"><link rel="prefetch" href="/assets/js/179.33b601f6.js"><link rel="prefetch" href="/assets/js/18.5cf79154.js"><link rel="prefetch" href="/assets/js/180.ab58c1c9.js"><link rel="prefetch" href="/assets/js/181.68d070a3.js"><link rel="prefetch" href="/assets/js/182.b57df2bd.js"><link rel="prefetch" href="/assets/js/183.7121c81d.js"><link rel="prefetch" href="/assets/js/184.f462882f.js"><link rel="prefetch" href="/assets/js/185.e5e88736.js"><link rel="prefetch" href="/assets/js/186.4631f648.js"><link rel="prefetch" href="/assets/js/187.a1f034a5.js"><link rel="prefetch" href="/assets/js/188.e8a0601d.js"><link rel="prefetch" href="/assets/js/189.365e8b35.js"><link rel="prefetch" href="/assets/js/19.ff125ee0.js"><link rel="prefetch" href="/assets/js/190.907801a0.js"><link rel="prefetch" href="/assets/js/191.97a9cbab.js"><link rel="prefetch" href="/assets/js/192.28d1a26e.js"><link rel="prefetch" href="/assets/js/193.01b017b2.js"><link rel="prefetch" href="/assets/js/194.7699d6c2.js"><link rel="prefetch" href="/assets/js/195.9c33ff6d.js"><link rel="prefetch" href="/assets/js/196.d57e9d28.js"><link rel="prefetch" href="/assets/js/197.258844c2.js"><link rel="prefetch" href="/assets/js/198.778361a0.js"><link rel="prefetch" href="/assets/js/199.aa7123b4.js"><link rel="prefetch" href="/assets/js/20.22498d96.js"><link rel="prefetch" href="/assets/js/200.b7bed910.js"><link rel="prefetch" href="/assets/js/202.ca1bca94.js"><link rel="prefetch" href="/assets/js/203.e70efcaf.js"><link rel="prefetch" href="/assets/js/204.617ee5fd.js"><link rel="prefetch" href="/assets/js/205.5faa04fb.js"><link rel="prefetch" href="/assets/js/206.9db25990.js"><link rel="prefetch" href="/assets/js/207.456cabc1.js"><link rel="prefetch" href="/assets/js/208.0fc4062b.js"><link rel="prefetch" href="/assets/js/209.0eb7ffe8.js"><link rel="prefetch" href="/assets/js/21.b044b3ee.js"><link rel="prefetch" href="/assets/js/210.fb60be9e.js"><link rel="prefetch" href="/assets/js/211.9275bc8d.js"><link rel="prefetch" href="/assets/js/212.9282ea2e.js"><link rel="prefetch" href="/assets/js/213.68d927da.js"><link rel="prefetch" href="/assets/js/214.6bc3ced6.js"><link rel="prefetch" href="/assets/js/215.3d788897.js"><link rel="prefetch" href="/assets/js/216.5256a7a8.js"><link rel="prefetch" href="/assets/js/217.c823f26e.js"><link rel="prefetch" href="/assets/js/218.bba27308.js"><link rel="prefetch" href="/assets/js/219.3082641f.js"><link rel="prefetch" href="/assets/js/22.b633bbd7.js"><link rel="prefetch" href="/assets/js/220.03c6ff6e.js"><link rel="prefetch" href="/assets/js/221.2f9a0155.js"><link rel="prefetch" href="/assets/js/222.427d9613.js"><link rel="prefetch" href="/assets/js/223.6d284cdb.js"><link rel="prefetch" href="/assets/js/224.f0c9a306.js"><link rel="prefetch" href="/assets/js/225.c789d52d.js"><link rel="prefetch" href="/assets/js/226.cc6f91d3.js"><link rel="prefetch" href="/assets/js/227.393bf727.js"><link rel="prefetch" href="/assets/js/228.e73f2d9e.js"><link rel="prefetch" href="/assets/js/229.92556bb1.js"><link rel="prefetch" href="/assets/js/23.469cefcb.js"><link rel="prefetch" href="/assets/js/230.b6509154.js"><link rel="prefetch" href="/assets/js/231.7c6ba4fb.js"><link rel="prefetch" href="/assets/js/232.f96d3284.js"><link rel="prefetch" href="/assets/js/233.8127a999.js"><link rel="prefetch" href="/assets/js/234.0c014c61.js"><link rel="prefetch" href="/assets/js/235.fb05dcca.js"><link rel="prefetch" href="/assets/js/236.07181426.js"><link rel="prefetch" href="/assets/js/237.7eff95c3.js"><link rel="prefetch" href="/assets/js/238.107d6e00.js"><link rel="prefetch" href="/assets/js/239.bbf844d6.js"><link rel="prefetch" href="/assets/js/24.b3b0e43f.js"><link rel="prefetch" href="/assets/js/240.199ca2d8.js"><link rel="prefetch" href="/assets/js/241.4d9fc141.js"><link rel="prefetch" href="/assets/js/242.d738c79a.js"><link rel="prefetch" href="/assets/js/243.147fc4c2.js"><link rel="prefetch" href="/assets/js/244.da806ea7.js"><link rel="prefetch" href="/assets/js/245.1ddd5986.js"><link rel="prefetch" href="/assets/js/246.d25cffe6.js"><link rel="prefetch" href="/assets/js/247.43bf4d54.js"><link rel="prefetch" href="/assets/js/248.354cc082.js"><link rel="prefetch" href="/assets/js/249.6b8d290c.js"><link rel="prefetch" href="/assets/js/25.2adff959.js"><link rel="prefetch" href="/assets/js/250.271cd368.js"><link rel="prefetch" href="/assets/js/251.5284a1bd.js"><link rel="prefetch" href="/assets/js/252.b93191c5.js"><link rel="prefetch" href="/assets/js/253.21784774.js"><link rel="prefetch" href="/assets/js/254.7d9a0c1b.js"><link rel="prefetch" href="/assets/js/255.69fd7056.js"><link rel="prefetch" href="/assets/js/256.e8158631.js"><link rel="prefetch" href="/assets/js/257.ad75dfe9.js"><link rel="prefetch" href="/assets/js/258.2bdbad9a.js"><link rel="prefetch" href="/assets/js/259.7d4b5fd6.js"><link rel="prefetch" href="/assets/js/26.cce6ab8b.js"><link rel="prefetch" href="/assets/js/260.3e305202.js"><link rel="prefetch" href="/assets/js/261.145b9726.js"><link rel="prefetch" href="/assets/js/262.230dda89.js"><link rel="prefetch" href="/assets/js/263.2d167d61.js"><link rel="prefetch" href="/assets/js/264.6e50a0cb.js"><link rel="prefetch" href="/assets/js/265.c3a127c7.js"><link rel="prefetch" href="/assets/js/266.025d9d3d.js"><link rel="prefetch" href="/assets/js/267.8b7a9cf6.js"><link rel="prefetch" href="/assets/js/268.509e31bf.js"><link rel="prefetch" href="/assets/js/269.369d9f50.js"><link rel="prefetch" href="/assets/js/27.b04b7f90.js"><link rel="prefetch" href="/assets/js/270.1b7b1e93.js"><link rel="prefetch" href="/assets/js/271.72f639af.js"><link rel="prefetch" href="/assets/js/272.79a85310.js"><link rel="prefetch" href="/assets/js/273.73e4a3c1.js"><link rel="prefetch" href="/assets/js/274.6d6354dc.js"><link rel="prefetch" href="/assets/js/275.5ceffd5f.js"><link rel="prefetch" href="/assets/js/276.6871c423.js"><link rel="prefetch" href="/assets/js/277.62efc810.js"><link rel="prefetch" href="/assets/js/278.3bdc7796.js"><link rel="prefetch" href="/assets/js/279.fa9bf76f.js"><link rel="prefetch" href="/assets/js/28.23af94b8.js"><link rel="prefetch" href="/assets/js/280.9e5f00f5.js"><link rel="prefetch" href="/assets/js/281.440eea68.js"><link rel="prefetch" href="/assets/js/282.ef486011.js"><link rel="prefetch" href="/assets/js/283.a42104a3.js"><link rel="prefetch" href="/assets/js/284.7ad7025c.js"><link rel="prefetch" href="/assets/js/285.27e3c7f2.js"><link rel="prefetch" href="/assets/js/286.c044d440.js"><link rel="prefetch" href="/assets/js/287.c6e35345.js"><link rel="prefetch" href="/assets/js/288.65d9e9ef.js"><link rel="prefetch" href="/assets/js/289.d3468932.js"><link rel="prefetch" href="/assets/js/29.2535358c.js"><link rel="prefetch" href="/assets/js/290.1276cd7f.js"><link rel="prefetch" href="/assets/js/291.2d8d3aa6.js"><link rel="prefetch" href="/assets/js/292.efee6772.js"><link rel="prefetch" href="/assets/js/293.22e1eb48.js"><link rel="prefetch" href="/assets/js/294.815a3917.js"><link rel="prefetch" href="/assets/js/295.765800a2.js"><link rel="prefetch" href="/assets/js/296.c65c5ef4.js"><link rel="prefetch" href="/assets/js/297.356d21bd.js"><link rel="prefetch" href="/assets/js/298.3c5a6ec9.js"><link rel="prefetch" href="/assets/js/299.f1799b22.js"><link rel="prefetch" href="/assets/js/3.a477f371.js"><link rel="prefetch" href="/assets/js/30.c5d7fef1.js"><link rel="prefetch" href="/assets/js/300.2bc9557a.js"><link rel="prefetch" href="/assets/js/301.ad6e0d40.js"><link rel="prefetch" href="/assets/js/302.378741a9.js"><link rel="prefetch" href="/assets/js/303.91f857d8.js"><link rel="prefetch" href="/assets/js/304.61836b40.js"><link rel="prefetch" href="/assets/js/305.a0aff3b6.js"><link rel="prefetch" href="/assets/js/306.f3753507.js"><link rel="prefetch" href="/assets/js/307.aa855d3b.js"><link rel="prefetch" href="/assets/js/308.4304d7fe.js"><link rel="prefetch" href="/assets/js/309.5186e7ae.js"><link rel="prefetch" href="/assets/js/31.6be1fd77.js"><link rel="prefetch" href="/assets/js/310.f391084d.js"><link rel="prefetch" href="/assets/js/311.fc4cbcc2.js"><link rel="prefetch" href="/assets/js/312.473dca57.js"><link rel="prefetch" href="/assets/js/313.10025a15.js"><link rel="prefetch" href="/assets/js/314.dad3a2ca.js"><link rel="prefetch" href="/assets/js/315.7afe3b2a.js"><link rel="prefetch" href="/assets/js/316.d8db9959.js"><link rel="prefetch" href="/assets/js/317.c0c95b55.js"><link rel="prefetch" href="/assets/js/318.5adfd720.js"><link rel="prefetch" href="/assets/js/319.7b8486e4.js"><link rel="prefetch" href="/assets/js/32.c1300d55.js"><link rel="prefetch" href="/assets/js/320.cb6a57dd.js"><link rel="prefetch" href="/assets/js/321.59f2f605.js"><link rel="prefetch" href="/assets/js/322.14eebbcf.js"><link rel="prefetch" href="/assets/js/323.cd4b6e2b.js"><link rel="prefetch" href="/assets/js/324.70d8e38c.js"><link rel="prefetch" href="/assets/js/325.a890de41.js"><link rel="prefetch" href="/assets/js/326.185c05f8.js"><link rel="prefetch" href="/assets/js/327.069bfdf8.js"><link rel="prefetch" href="/assets/js/328.e6b5259e.js"><link rel="prefetch" href="/assets/js/329.5da42abd.js"><link rel="prefetch" href="/assets/js/33.2741f9ec.js"><link rel="prefetch" href="/assets/js/330.ece88f5f.js"><link rel="prefetch" href="/assets/js/331.310efdd1.js"><link rel="prefetch" href="/assets/js/332.e662e583.js"><link rel="prefetch" href="/assets/js/333.daeaf690.js"><link rel="prefetch" href="/assets/js/334.710c3175.js"><link rel="prefetch" href="/assets/js/335.4ed14580.js"><link rel="prefetch" href="/assets/js/336.9f2951df.js"><link rel="prefetch" href="/assets/js/337.56939a22.js"><link rel="prefetch" href="/assets/js/34.fd5b58ef.js"><link rel="prefetch" href="/assets/js/35.f3d4d90d.js"><link rel="prefetch" href="/assets/js/36.d17270e9.js"><link rel="prefetch" href="/assets/js/37.6c81c9e2.js"><link rel="prefetch" href="/assets/js/38.ea9da031.js"><link rel="prefetch" href="/assets/js/39.db40f8d4.js"><link rel="prefetch" href="/assets/js/40.97fcde84.js"><link rel="prefetch" href="/assets/js/41.510afd51.js"><link rel="prefetch" href="/assets/js/42.94a9230e.js"><link rel="prefetch" href="/assets/js/43.ced307a0.js"><link rel="prefetch" href="/assets/js/44.74b868f7.js"><link rel="prefetch" href="/assets/js/45.efdce5e8.js"><link rel="prefetch" href="/assets/js/46.e5ddd235.js"><link rel="prefetch" href="/assets/js/47.857430ba.js"><link rel="prefetch" href="/assets/js/48.c0fe4959.js"><link rel="prefetch" href="/assets/js/49.1258bdb0.js"><link rel="prefetch" href="/assets/js/5.621fe0d4.js"><link rel="prefetch" href="/assets/js/50.ada8e824.js"><link rel="prefetch" href="/assets/js/51.c3767650.js"><link rel="prefetch" href="/assets/js/52.2bb268fd.js"><link rel="prefetch" href="/assets/js/53.b54d2bc3.js"><link rel="prefetch" href="/assets/js/54.b1ccebdd.js"><link rel="prefetch" href="/assets/js/55.a7ca142a.js"><link rel="prefetch" href="/assets/js/56.944ed9e9.js"><link rel="prefetch" href="/assets/js/57.04a57837.js"><link rel="prefetch" href="/assets/js/58.90273ae0.js"><link rel="prefetch" href="/assets/js/59.d7625065.js"><link rel="prefetch" href="/assets/js/6.29517aa3.js"><link rel="prefetch" href="/assets/js/60.9664c548.js"><link rel="prefetch" href="/assets/js/61.a462a720.js"><link rel="prefetch" href="/assets/js/62.f5f7e116.js"><link rel="prefetch" href="/assets/js/63.02315ce5.js"><link rel="prefetch" href="/assets/js/64.5ca47bb1.js"><link rel="prefetch" href="/assets/js/65.93fae741.js"><link rel="prefetch" href="/assets/js/66.f9b894cf.js"><link rel="prefetch" href="/assets/js/67.1f5a4b76.js"><link rel="prefetch" href="/assets/js/68.459dd474.js"><link rel="prefetch" href="/assets/js/69.23be36b5.js"><link rel="prefetch" href="/assets/js/7.9c568b26.js"><link rel="prefetch" href="/assets/js/70.bbd87a13.js"><link rel="prefetch" href="/assets/js/71.7b0757ab.js"><link rel="prefetch" href="/assets/js/72.cb5a8bd0.js"><link rel="prefetch" href="/assets/js/73.956b96ed.js"><link rel="prefetch" href="/assets/js/74.ecd5b136.js"><link rel="prefetch" href="/assets/js/75.30fa59d1.js"><link rel="prefetch" href="/assets/js/76.e611c95a.js"><link rel="prefetch" href="/assets/js/77.44e843c7.js"><link rel="prefetch" href="/assets/js/78.c8486746.js"><link rel="prefetch" href="/assets/js/79.e3ee824f.js"><link rel="prefetch" href="/assets/js/8.5585ad74.js"><link rel="prefetch" href="/assets/js/80.795f997e.js"><link rel="prefetch" href="/assets/js/81.7a5a49a9.js"><link rel="prefetch" href="/assets/js/82.4243feb4.js"><link rel="prefetch" href="/assets/js/83.9f2f04d3.js"><link rel="prefetch" href="/assets/js/84.71c5eeb5.js"><link rel="prefetch" href="/assets/js/85.3560b80d.js"><link rel="prefetch" href="/assets/js/86.755b1ffa.js"><link rel="prefetch" href="/assets/js/87.f65fcda2.js"><link rel="prefetch" href="/assets/js/88.90bc2b4b.js"><link rel="prefetch" href="/assets/js/89.8509c024.js"><link rel="prefetch" href="/assets/js/9.09329d8a.js"><link rel="prefetch" href="/assets/js/90.faaae6da.js"><link rel="prefetch" href="/assets/js/91.26f3c858.js"><link rel="prefetch" href="/assets/js/92.6c36bda8.js"><link rel="prefetch" href="/assets/js/93.a4da6659.js"><link rel="prefetch" href="/assets/js/94.c31c503d.js"><link rel="prefetch" href="/assets/js/95.5d1df917.js"><link rel="prefetch" href="/assets/js/96.2cf24e7b.js"><link rel="prefetch" href="/assets/js/97.0c603d48.js"><link rel="prefetch" href="/assets/js/98.2c36ad9c.js"><link rel="prefetch" href="/assets/js/99.06f7f641.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.0d5f8fef.js">
    <link rel="stylesheet" href="/assets/css/0.styles.89e32c3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><!----> <span class="site-name">狸猫小僧</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/zh/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/zh/interview/" class="nav-link">
  面试
</a></div><div class="nav-item"><a href="/zh/DevBasic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/zh/DevAdvance/" class="nav-link router-link-active">
  高级
</a></div><div class="nav-item"><a href="/zh/Frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/zh/Media/" class="nav-link">
  多媒体
</a></div><div class="nav-item"><a href="/zh/DevOthers/" class="nav-link">
  杂谈
</a></div><div class="nav-item"><a href="/zh/article/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/zh/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/zhengxiaochuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    官网
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/zh/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/zh/interview/" class="nav-link">
  面试
</a></div><div class="nav-item"><a href="/zh/DevBasic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/zh/DevAdvance/" class="nav-link router-link-active">
  高级
</a></div><div class="nav-item"><a href="/zh/Frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/zh/Media/" class="nav-link">
  多媒体
</a></div><div class="nav-item"><a href="/zh/DevOthers/" class="nav-link">
  杂谈
</a></div><div class="nav-item"><a href="/zh/article/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/zh/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/zhengxiaochuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    官网
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot整合</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringSecurity</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>编程方法论</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微服务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>微服务技术运用</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/DevAdvance/MicroServiceSkill/SpringCloud01/SpringCloud01.html" class="sidebar-link">SpringCloud01</a></li><li><a href="/zh/DevAdvance/MicroServiceSkill/SpringCloud02/SpringCloud实用篇02.html" class="sidebar-link">SpringCloud实用篇02</a></li><li><a href="/zh/DevAdvance/MicroServiceSkill/Docker/Docker实用篇.html" class="sidebar-link">Docker实用篇</a></li><li><a href="/zh/DevAdvance/MicroServiceSkill/MQ/RabbitMQ.html" class="sidebar-link">RabbitMQ</a></li><li><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html" class="active sidebar-link">分布式搜索引擎01</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-1-了解es" class="sidebar-link">1.1.了解ES</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-1-1-elasticsearch的作用" class="sidebar-link">1.1.1.elasticsearch的作用</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-1-2-elk技术栈" class="sidebar-link">1.1.2.ELK技术栈</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-1-3-elasticsearch和lucene" class="sidebar-link">1.1.3.elasticsearch和lucene</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-1-4-为什么不是其他搜索技术" class="sidebar-link">1.1.4.为什么不是其他搜索技术？</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-1-5-总结" class="sidebar-link">1.1.5.总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-2-倒排索引" class="sidebar-link">1.2.倒排索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-2-1-正向索引" class="sidebar-link">1.2.1.正向索引</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-2-2-倒排索引" class="sidebar-link">1.2.2.倒排索引</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-2-3-正向和倒排" class="sidebar-link">1.2.3.正向和倒排</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-3-es的一些概念" class="sidebar-link">1.3.es的一些概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-3-1-文档和字段" class="sidebar-link">1.3.1.文档和字段</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-3-2-索引和映射" class="sidebar-link">1.3.2.索引和映射</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-3-3-mysql与elasticsearch" class="sidebar-link">1.3.3.mysql与elasticsearch</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-4-安装es、kibana" class="sidebar-link">1.4.安装es、kibana</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-4-1-安装" class="sidebar-link">1.4.1.安装</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-4-2-分词器" class="sidebar-link">1.4.2.分词器</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_1-4-3-总结" class="sidebar-link">1.4.3.总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_2-1-mapping映射属性" class="sidebar-link">2.1.mapping映射属性</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_2-2-索引库的crud" class="sidebar-link">2.2.索引库的CRUD</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_2-2-1-创建索引库和映射" class="sidebar-link">2.2.1.创建索引库和映射</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_2-2-2-查询索引库" class="sidebar-link">2.2.2.查询索引库</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_2-2-3-修改索引库" class="sidebar-link">2.2.3.修改索引库</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_2-2-4-删除索引库" class="sidebar-link">2.2.4.删除索引库</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_2-2-5-总结" class="sidebar-link">2.2.5.总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_3-1-新增文档" class="sidebar-link">3.1.新增文档</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_3-2-查询文档" class="sidebar-link">3.2.查询文档</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_3-3-删除文档" class="sidebar-link">3.3.删除文档</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_3-4-修改文档" class="sidebar-link">3.4.修改文档</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_3-4-1-全量修改" class="sidebar-link">3.4.1.全量修改</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_3-4-2-增量修改" class="sidebar-link">3.4.2.增量修改</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_3-5-总结" class="sidebar-link">3.5.总结</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_4-0-导入demo工程" class="sidebar-link">4.0.导入Demo工程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_4-0-1-导入数据" class="sidebar-link">4.0.1.导入数据</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_4-0-2-导入项目" class="sidebar-link">4.0.2.导入项目</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_4-0-3-mapping映射分析" class="sidebar-link">4.0.3.mapping映射分析</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_4-0-4-初始化restclient" class="sidebar-link">4.0.4.初始化RestClient</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_4-1-创建索引库" class="sidebar-link">4.1.创建索引库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_4-1-1-代码解读" class="sidebar-link">4.1.1.代码解读</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_4-1-2-完整示例" class="sidebar-link">4.1.2.完整示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_4-2-删除索引库" class="sidebar-link">4.2.删除索引库</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_4-3-判断索引库是否存在" class="sidebar-link">4.3.判断索引库是否存在</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_4-4-总结" class="sidebar-link">4.4.总结</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_5-1-新增文档" class="sidebar-link">5.1.新增文档</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_5-1-1-索引库实体类" class="sidebar-link">5.1.1.索引库实体类</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_5-1-2-语法说明" class="sidebar-link">5.1.2.语法说明</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_5-1-3-完整代码" class="sidebar-link">5.1.3.完整代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_5-2-查询文档" class="sidebar-link">5.2.查询文档</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_5-2-1-语法说明" class="sidebar-link">5.2.1.语法说明</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_5-2-2-完整代码" class="sidebar-link">5.2.2.完整代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_5-3-删除文档" class="sidebar-link">5.3.删除文档</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_5-4-修改文档" class="sidebar-link">5.4.修改文档</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_5-4-1-语法说明" class="sidebar-link">5.4.1.语法说明</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_5-4-2-完整代码" class="sidebar-link">5.4.2.完整代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_5-5-批量导入文档" class="sidebar-link">5.5.批量导入文档</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_5-5-1-语法说明" class="sidebar-link">5.5.1.语法说明</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_5-5-2-完整代码" class="sidebar-link">5.5.2.完整代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch01/分布式搜索引擎01.html#_5-6-小结" class="sidebar-link">5.6.小结</a></li></ul></li><li><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch02/分布式搜索引擎02.html" class="sidebar-link">分布式搜索引擎02</a></li><li><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch03/分布式搜索引擎03.html" class="sidebar-link">分布式搜索引擎03</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker容器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>解决方案</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="分布式搜索引擎01"><a href="#分布式搜索引擎01" class="header-anchor">#</a> 分布式搜索引擎01</h1> <p>-- elasticsearch基础</p> <h1 id="_0-学习目标"><a href="#_0-学习目标" class="header-anchor">#</a> 0.学习目标</h1> <h1 id="_1-初识elasticsearch"><a href="#_1-初识elasticsearch" class="header-anchor">#</a> 1.初识elasticsearch</h1> <h2 id="_1-1-了解es"><a href="#_1-1-了解es" class="header-anchor">#</a> 1.1.了解ES</h2> <h3 id="_1-1-1-elasticsearch的作用"><a href="#_1-1-1-elasticsearch的作用" class="header-anchor">#</a> 1.1.1.elasticsearch的作用</h3> <p>elasticsearch是一款非常强大的开源搜索引擎，具备非常多强大功能，可以帮助我们从海量数据中快速找到需要的内容</p> <p>例如：</p> <ul><li><p>在GitHub搜索代码</p> <p><img src="assets/image-20210720193623245.png" alt="image-20210720193623245"></p></li> <li><p>在电商网站搜索商品</p> <p><img src="assets/image-20210720193633483.png" alt="image-20210720193633483"></p></li> <li><p>在百度搜索答案</p> <p><img src="assets/image-20210720193641907.png" alt="image-20210720193641907"></p></li> <li><p>在打车软件搜索附近的车</p> <p><img src="assets/image-20210720193648044.png" alt="image-20210720193648044"></p></li></ul> <h3 id="_1-1-2-elk技术栈"><a href="#_1-1-2-elk技术栈" class="header-anchor">#</a> 1.1.2.ELK技术栈</h3> <p>elasticsearch结合kibana、Logstash、Beats，也就是elastic stack（ELK）。被广泛应用在日志数据分析、实时监控等领域：</p> <p><img src="assets/image-20210720194008781.png" alt="image-20210720194008781"></p> <p>而elasticsearch是elastic stack的核心，负责存储、搜索、分析数据。</p> <p><img src="assets/image-20210720194230265.png" alt="image-20210720194230265"></p> <h3 id="_1-1-3-elasticsearch和lucene"><a href="#_1-1-3-elasticsearch和lucene" class="header-anchor">#</a> 1.1.3.elasticsearch和lucene</h3> <p>elasticsearch底层是基于<strong>lucene</strong>来实现的。</p> <p><strong>Lucene</strong>是一个Java语言的搜索引擎类库，是Apache公司的顶级项目，由DougCutting于1999年研发。官网地址：https://lucene.apache.org/ 。</p> <p><img src="assets/image-20210720194547780.png" alt="image-20210720194547780"></p> <p><strong>elasticsearch</strong>的发展历史：</p> <ul><li>2004年Shay Banon基于Lucene开发了Compass</li> <li>2010年Shay Banon 重写了Compass，取名为Elasticsearch。</li></ul> <p><img src="assets/image-20210720195001221.png" alt="image-20210720195001221"></p> <h3 id="_1-1-4-为什么不是其他搜索技术"><a href="#_1-1-4-为什么不是其他搜索技术" class="header-anchor">#</a> 1.1.4.为什么不是其他搜索技术？</h3> <p>目前比较知名的搜索引擎技术排名：</p> <p><img src="assets/image-20210720195142535.png" alt="image-20210720195142535"></p> <p>虽然在早期，Apache Solr是最主要的搜索引擎技术，但随着发展elasticsearch已经渐渐超越了Solr，独占鳌头：</p> <p><img src="assets/image-20210720195306484.png" alt="image-20210720195306484"></p> <h3 id="_1-1-5-总结"><a href="#_1-1-5-总结" class="header-anchor">#</a> 1.1.5.总结</h3> <p>什么是elasticsearch？</p> <ul><li>一个开源的分布式搜索引擎，可以用来实现搜索、日志统计、分析、系统监控等功能</li></ul> <p>什么是elastic stack（ELK）？</p> <ul><li>是以elasticsearch为核心的技术栈，包括beats、Logstash、kibana、elasticsearch</li></ul> <p>什么是Lucene？</p> <ul><li>是Apache的开源搜索引擎类库，提供了搜索引擎的核心API</li></ul> <h2 id="_1-2-倒排索引"><a href="#_1-2-倒排索引" class="header-anchor">#</a> 1.2.倒排索引</h2> <p>倒排索引的概念是基于MySQL这样的正向索引而言的。</p> <h3 id="_1-2-1-正向索引"><a href="#_1-2-1-正向索引" class="header-anchor">#</a> 1.2.1.正向索引</h3> <p>那么什么是正向索引呢？例如给下表（tb_goods）中的id创建索引：</p> <p><img src="assets/image-20210720195531539.png" alt="image-20210720195531539"></p> <p>如果是根据id查询，那么直接走索引，查询速度非常快。</p> <p>但如果是基于title做模糊查询，只能是逐行扫描数据，流程如下：</p> <p>1）用户搜索数据，条件是title符合<code>&quot;%手机%&quot;</code></p> <p>2）逐行获取数据，比如id为1的数据</p> <p>3）判断数据中的title是否符合用户搜索条件</p> <p>4）如果符合则放入结果集，不符合则丢弃。回到步骤1</p> <p>逐行扫描，也就是全表扫描，随着数据量增加，其查询效率也会越来越低。当数据量达到数百万时，就是一场灾难。</p> <h3 id="_1-2-2-倒排索引"><a href="#_1-2-2-倒排索引" class="header-anchor">#</a> 1.2.2.倒排索引</h3> <p>倒排索引中有两个非常重要的概念：</p> <ul><li>文档（<code>Document</code>）：用来搜索的数据，其中的每一条数据就是一个文档。例如一个网页、一个商品信息</li> <li>词条（<code>Term</code>）：对文档数据或用户搜索数据，利用某种算法分词，得到的具备含义的词语就是词条。例如：我是中国人，就可以分为：我、是、中国人、中国、国人这样的几个词条</li></ul> <p><strong>创建倒排索引</strong>是对正向索引的一种特殊处理，流程如下：</p> <ul><li>将每一个文档的数据利用算法分词，得到一个个词条</li> <li>创建表，每行数据包括词条、词条所在文档id、位置等信息</li> <li>因为词条唯一性，可以给词条创建索引，例如hash表结构索引</li></ul> <p>如图：</p> <p><img src="assets/image-20210720200457207.png" alt="image-20210720200457207"></p> <p>倒排索引的<strong>搜索流程</strong>如下（以搜索&quot;华为手机&quot;为例）：</p> <p>1）用户输入条件<code>&quot;华为手机&quot;</code>进行搜索。</p> <p>2）对用户输入内容<strong>分词</strong>，得到词条：<code>华为</code>、<code>手机</code>。</p> <p>3）拿着词条在倒排索引中查找，可以得到包含词条的文档id：1、2、3。</p> <p>4）拿着文档id到正向索引中查找具体文档。</p> <p>如图：</p> <p><img src="assets/image-20210720201115192.png" alt="image-20210720201115192"></p> <p>虽然要先查询倒排索引，再查询倒排索引，但是无论是词条、还是文档id都建立了索引，查询速度非常快！无需全表扫描。</p> <h3 id="_1-2-3-正向和倒排"><a href="#_1-2-3-正向和倒排" class="header-anchor">#</a> 1.2.3.正向和倒排</h3> <p>那么为什么一个叫做正向索引，一个叫做倒排索引呢？</p> <ul><li><p><strong>正向索引</strong>是最传统的，根据id索引的方式。但根据词条查询时，必须先逐条获取每个文档，然后判断文档中是否包含所需要的词条，是<strong>根据文档找词条的过程</strong>。</p></li> <li><p>而<strong>倒排索引</strong>则相反，是先找到用户要搜索的词条，根据词条得到保护词条的文档的id，然后根据id获取文档。是<strong>根据词条找文档的过程</strong>。</p></li></ul> <p>是不是恰好反过来了？</p> <p>那么两者方式的优缺点是什么呢？</p> <p><strong>正向索引</strong>：</p> <ul><li>优点：
<ul><li>可以给多个字段创建索引</li> <li>根据索引字段搜索、排序速度非常快</li></ul></li> <li>缺点：
<ul><li>根据非索引字段，或者索引字段中的部分词条查找时，只能全表扫描。</li></ul></li></ul> <p><strong>倒排索引</strong>：</p> <ul><li>优点：
<ul><li>根据词条搜索、模糊搜索时，速度非常快</li></ul></li> <li>缺点：
<ul><li>只能给词条创建索引，而不是字段</li> <li>无法根据字段做排序</li></ul></li></ul> <h2 id="_1-3-es的一些概念"><a href="#_1-3-es的一些概念" class="header-anchor">#</a> 1.3.es的一些概念</h2> <p>elasticsearch中有很多独有的概念，与mysql中略有差别，但也有相似之处。</p> <h3 id="_1-3-1-文档和字段"><a href="#_1-3-1-文档和字段" class="header-anchor">#</a> 1.3.1.文档和字段</h3> <p>elasticsearch是面向**文档（Document）**存储的，可以是数据库中的一条商品数据，一个订单信息。文档数据会被序列化为json格式后存储在elasticsearch中：</p> <p><img src="assets/image-20210720202707797.png" alt="image-20210720202707797"></p> <p>而Json文档中往往包含很多的<strong>字段（Field）</strong>，类似于数据库中的列。</p> <h3 id="_1-3-2-索引和映射"><a href="#_1-3-2-索引和映射" class="header-anchor">#</a> 1.3.2.索引和映射</h3> <p><strong>索引（Index）</strong>，就是相同类型的文档的集合。</p> <p>例如：</p> <ul><li>所有用户文档，就可以组织在一起，称为用户的索引；</li> <li>所有商品的文档，可以组织在一起，称为商品的索引；</li> <li>所有订单的文档，可以组织在一起，称为订单的索引；</li></ul> <p><img src="assets/image-20210720203022172.png" alt="image-20210720203022172"></p> <p>因此，我们可以把索引当做是数据库中的表。</p> <p>数据库的表会有约束信息，用来定义表的结构、字段的名称、类型等信息。因此，索引库中就有<strong>映射（mapping）</strong>，是索引中文档的字段约束信息，类似表的结构约束。</p> <h3 id="_1-3-3-mysql与elasticsearch"><a href="#_1-3-3-mysql与elasticsearch" class="header-anchor">#</a> 1.3.3.mysql与elasticsearch</h3> <p>我们统一的把mysql与elasticsearch的概念做一下对比：</p> <table><thead><tr><th><strong>MySQL</strong></th> <th><strong>Elasticsearch</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>Table</td> <td>Index</td> <td>索引(index)，就是文档的集合，类似数据库的表(table)</td></tr> <tr><td>Row</td> <td>Document</td> <td>文档（Document），就是一条条的数据，类似数据库中的行（Row），文档都是JSON格式</td></tr> <tr><td>Column</td> <td>Field</td> <td>字段（Field），就是JSON文档中的字段，类似数据库中的列（Column）</td></tr> <tr><td>Schema</td> <td>Mapping</td> <td>Mapping（映射）是索引中文档的约束，例如字段类型约束。类似数据库的表结构（Schema）</td></tr> <tr><td>SQL</td> <td>DSL</td> <td>DSL是elasticsearch提供的JSON风格的请求语句，用来操作elasticsearch，实现CRUD</td></tr></tbody></table> <p>是不是说，我们学习了elasticsearch就不再需要mysql了呢？</p> <p>并不是如此，两者各自有自己的擅长支出：</p> <ul><li><p>Mysql：擅长事务类型操作，可以确保数据的安全和一致性</p></li> <li><p>Elasticsearch：擅长海量数据的搜索、分析、计算</p></li></ul> <p>因此在企业中，往往是两者结合使用：</p> <ul><li>对安全性要求较高的写操作，使用mysql实现</li> <li>对查询性能要求较高的搜索需求，使用elasticsearch实现</li> <li>两者再基于某种方式，实现数据的同步，保证一致性</li></ul> <p><img src="assets/image-20210720203534945.png" alt="image-20210720203534945"></p> <h2 id="_1-4-安装es、kibana"><a href="#_1-4-安装es、kibana" class="header-anchor">#</a> 1.4.安装es、kibana</h2> <h3 id="_1-4-1-安装"><a href="#_1-4-1-安装" class="header-anchor">#</a> 1.4.1.安装</h3> <p>参考课前资料：</p> <p><img src="assets/image-20210720203805350.png" alt="image-20210720203805350"></p> <h3 id="_1-4-2-分词器"><a href="#_1-4-2-分词器" class="header-anchor">#</a> 1.4.2.分词器</h3> <p>参考课前资料：</p> <p><img src="assets/image-20210720203805350.png" alt="image-20210720203805350"></p> <h3 id="_1-4-3-总结"><a href="#_1-4-3-总结" class="header-anchor">#</a> 1.4.3.总结</h3> <p>分词器的作用是什么？</p> <ul><li>创建倒排索引时对文档分词</li> <li>用户搜索时，对输入的内容分词</li></ul> <p>IK分词器有几种模式？</p> <ul><li>ik_smart：智能切分，粗粒度</li> <li>ik_max_word：最细切分，细粒度</li></ul> <p>IK分词器如何拓展词条？如何停用词条？</p> <ul><li>利用config目录的IkAnalyzer.cfg.xml文件添加拓展词典和停用词典</li> <li>在词典中添加拓展词条或者停用词条</li></ul> <h1 id="_2-索引库操作"><a href="#_2-索引库操作" class="header-anchor">#</a> 2.索引库操作</h1> <p>索引库就类似数据库表，mapping映射就类似表的结构。</p> <p>我们要向es中存储数据，必须先创建“库”和“表”。</p> <h2 id="_2-1-mapping映射属性"><a href="#_2-1-mapping映射属性" class="header-anchor">#</a> 2.1.mapping映射属性</h2> <p>mapping是对索引库中文档的约束，常见的mapping属性包括：</p> <ul><li>type：字段数据类型，常见的简单类型有：
<ul><li>字符串：text（可分词的文本）、keyword（精确值，例如：品牌、国家、ip地址）</li> <li>数值：long、integer、short、byte、double、float、</li> <li>布尔：boolean</li> <li>日期：date</li> <li>对象：object</li></ul></li> <li>index：是否创建索引，默认为true</li> <li>analyzer：使用哪种分词器</li> <li>properties：该字段的子字段</li></ul> <p>例如下面的json文档：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
    <span class="token property">&quot;weight&quot;</span><span class="token operator">:</span> <span class="token number">52.1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;isMarried&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token string">&quot;黑马程序员Java讲师&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zy@itcast.cn&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;score&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">99.1</span><span class="token punctuation">,</span> <span class="token number">99.5</span><span class="token punctuation">,</span> <span class="token number">98.9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;firstName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;云&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;lastName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;赵&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>对应的每个字段映射（mapping）：</p> <ul><li>age：类型为 integer；参与搜索，因此需要index为true；无需分词器</li> <li>weight：类型为float；参与搜索，因此需要index为true；无需分词器</li> <li>isMarried：类型为boolean；参与搜索，因此需要index为true；无需分词器</li> <li>info：类型为字符串，需要分词，因此是text；参与搜索，因此需要index为true；分词器可以用ik_smart</li> <li>email：类型为字符串，但是不需要分词，因此是keyword；不参与搜索，因此需要index为false；无需分词器</li> <li>score：虽然是数组，但是我们只看元素的类型，类型为float；参与搜索，因此需要index为true；无需分词器</li> <li>name：类型为object，需要定义多个子属性
<ul><li>name.firstName；类型为字符串，但是不需要分词，因此是keyword；参与搜索，因此需要index为true；无需分词器</li> <li>name.lastName；类型为字符串，但是不需要分词，因此是keyword；参与搜索，因此需要index为true；无需分词器</li></ul></li></ul> <h2 id="_2-2-索引库的crud"><a href="#_2-2-索引库的crud" class="header-anchor">#</a> 2.2.索引库的CRUD</h2> <p>这里我们统一使用Kibana编写DSL的方式来演示。</p> <h3 id="_2-2-1-创建索引库和映射"><a href="#_2-2-1-创建索引库和映射" class="header-anchor">#</a> 2.2.1.创建索引库和映射</h3> <h4 id="基本语法"><a href="#基本语法" class="header-anchor">#</a> 基本语法：</h4> <ul><li>请求方式：PUT</li> <li>请求路径：/索引库名，可以自定义</li> <li>请求参数：mapping映射</li></ul> <p>格式：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>PUT /索引库名称
<span class="token punctuation">{</span>
  <span class="token property">&quot;mappings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;字段名&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;字段名2&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;false&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;字段名3&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;子字段&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// ...略</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="示例"><a href="#示例" class="header-anchor">#</a> 示例：</h4> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>PUT /heima
<span class="token punctuation">{</span>
  <span class="token string">&quot;mappings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;info&quot;</span>:<span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;text&quot;</span>,
        <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ik_smart&quot;</span>
      <span class="token punctuation">}</span>,
      <span class="token string">&quot;email&quot;</span>:<span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;keyword&quot;</span>,
        <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;falsae&quot;</span>
      <span class="token punctuation">}</span>,
      <span class="token string">&quot;name&quot;</span>:<span class="token punctuation">{</span>
        <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;firstName&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;keyword&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>,
      // <span class="token punctuation">..</span>. 略
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_2-2-2-查询索引库"><a href="#_2-2-2-查询索引库" class="header-anchor">#</a> 2.2.2.查询索引库</h3> <p><strong>基本语法</strong>：</p> <ul><li><p>请求方式：GET</p></li> <li><p>请求路径：/索引库名</p></li> <li><p>请求参数：无</p></li></ul> <p><strong>格式</strong>：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>GET /索引库名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>示例</strong>：</p> <p><img src="assets/image-20210720211019329.png" alt="image-20210720211019329"></p> <h3 id="_2-2-3-修改索引库"><a href="#_2-2-3-修改索引库" class="header-anchor">#</a> 2.2.3.修改索引库</h3> <p>倒排索引结构虽然不复杂，但是一旦数据结构改变（比如改变了分词器），就需要重新创建倒排索引，这简直是灾难。因此索引库<strong>一旦创建，无法修改mapping</strong>。</p> <p>虽然无法修改mapping中已有的字段，但是却允许添加新的字段到mapping中，因为不会对倒排索引产生影响。</p> <p><strong>语法说明</strong>：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>PUT /索引库名/_mapping
<span class="token punctuation">{</span>
  <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;新字段名&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;integer&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>示例</strong>：</p> <p><img src="assets/image-20210720212357390.png" alt="image-20210720212357390"></p> <h3 id="_2-2-4-删除索引库"><a href="#_2-2-4-删除索引库" class="header-anchor">#</a> 2.2.4.删除索引库</h3> <p><strong>语法：</strong></p> <ul><li><p>请求方式：DELETE</p></li> <li><p>请求路径：/索引库名</p></li> <li><p>请求参数：无</p></li></ul> <p><strong>格式：</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>DELETE /索引库名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在kibana中测试：</p> <p><img src="assets/image-20210720212123420.png" alt="image-20210720212123420"></p> <h3 id="_2-2-5-总结"><a href="#_2-2-5-总结" class="header-anchor">#</a> 2.2.5.总结</h3> <p>索引库操作有哪些？</p> <ul><li>创建索引库：PUT /索引库名</li> <li>查询索引库：GET /索引库名</li> <li>删除索引库：DELETE /索引库名</li> <li>添加字段：PUT /索引库名/_mapping</li></ul> <h1 id="_3-文档操作"><a href="#_3-文档操作" class="header-anchor">#</a> 3.文档操作</h1> <h2 id="_3-1-新增文档"><a href="#_3-1-新增文档" class="header-anchor">#</a> 3.1.新增文档</h2> <p><strong>语法：</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>POST /索引库名/_doc/文档id
<span class="token punctuation">{</span>
    <span class="token property">&quot;字段1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;值1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;字段2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;值2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;字段3&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;子属性1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;值3&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;子属性2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;值4&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>示例：</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>POST /heima/_doc/<span class="token number">1</span>
<span class="token punctuation">{</span>
    <span class="token property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token string">&quot;黑马程序员Java讲师&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zy@itcast.cn&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;firstName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;云&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;lastName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;赵&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>响应：</strong></p> <p><img src="assets/image-20210720212933362.png" alt="image-20210720212933362"></p> <h2 id="_3-2-查询文档"><a href="#_3-2-查询文档" class="header-anchor">#</a> 3.2.查询文档</h2> <p>根据rest风格，新增是post，查询应该是get，不过查询一般都需要条件，这里我们把文档id带上。</p> <p><strong>语法：</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET /<span class="token punctuation">{</span>索引库名称<span class="token punctuation">}</span>/_doc/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>通过kibana查看数据：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>heima<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>查看结果：</strong></p> <p><img src="assets/image-20210720213345003.png" alt="image-20210720213345003"></p> <h2 id="_3-3-删除文档"><a href="#_3-3-删除文档" class="header-anchor">#</a> 3.3.删除文档</h2> <p>删除使用DELETE请求，同样，需要根据id进行删除：</p> <p><strong>语法：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">DELETE</span> <span class="token operator">/</span><span class="token punctuation">{</span>索引库名<span class="token punctuation">}</span><span class="token operator">/</span>_doc<span class="token operator">/</span>id值
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>示例：</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code># 根据id删除数据
DELETE /heima/_doc/<span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>结果：</strong></p> <p><img src="assets/image-20210720213634918.png" alt="image-20210720213634918"></p> <h2 id="_3-4-修改文档"><a href="#_3-4-修改文档" class="header-anchor">#</a> 3.4.修改文档</h2> <p>修改有两种方式：</p> <ul><li>全量修改：直接覆盖原来的文档</li> <li>增量修改：修改文档中的部分字段</li></ul> <h3 id="_3-4-1-全量修改"><a href="#_3-4-1-全量修改" class="header-anchor">#</a> 3.4.1.全量修改</h3> <p>全量修改是覆盖原来的文档，其本质是：</p> <ul><li>根据指定的id删除文档</li> <li>新增一个相同id的文档</li></ul> <p><strong>注意</strong>：如果根据id删除时，id不存在，第二步的新增也会执行，也就从修改变成了新增操作了。</p> <p><strong>语法：</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>PUT /<span class="token punctuation">{</span>索引库名<span class="token punctuation">}</span>/_doc/文档id
<span class="token punctuation">{</span>
    <span class="token property">&quot;字段1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;值1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;字段2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;值2&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// ... 略</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>示例：</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>PUT /heima/_doc/<span class="token number">1</span>
<span class="token punctuation">{</span>
    <span class="token property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token string">&quot;黑马程序员高级Java讲师&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zy@itcast.cn&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;firstName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;云&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;lastName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;赵&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-4-2-增量修改"><a href="#_3-4-2-增量修改" class="header-anchor">#</a> 3.4.2.增量修改</h3> <p>增量修改是只修改指定id匹配的文档中的部分字段。</p> <p><strong>语法：</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>POST /<span class="token punctuation">{</span>索引库名<span class="token punctuation">}</span>/_update/文档id
<span class="token punctuation">{</span>
    <span class="token property">&quot;doc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token property">&quot;字段名&quot;</span><span class="token operator">:</span> <span class="token string">&quot;新的值&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>示例：</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>POST /heima/_update/<span class="token number">1</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;doc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ZhaoYun@itcast.cn&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_3-5-总结"><a href="#_3-5-总结" class="header-anchor">#</a> 3.5.总结</h2> <p>文档操作有哪些？</p> <ul><li>创建文档：POST /{索引库名}/_doc/文档id   { json文档 }</li> <li>查询文档：GET /{索引库名}/_doc/文档id</li> <li>删除文档：DELETE /{索引库名}/_doc/文档id</li> <li>修改文档：
<ul><li>全量修改：PUT /{索引库名}/_doc/文档id { json文档 }</li> <li>增量修改：POST /{索引库名}/_update/文档id { &quot;doc&quot;: {字段}}</li></ul></li></ul> <h1 id="_4-restapi"><a href="#_4-restapi" class="header-anchor">#</a> 4.RestAPI</h1> <p>ES官方提供了各种不同语言的客户端，用来操作ES。这些客户端的本质就是组装DSL语句，通过http请求发送给ES。官方文档地址：https://www.elastic.co/guide/en/elasticsearch/client/index.html</p> <p>其中的Java Rest Client又包括两种：</p> <ul><li>Java Low Level Rest Client</li> <li>Java High Level Rest Client</li></ul> <p><img src="assets/image-20210720214555863.png" alt="image-20210720214555863"></p> <p>我们学习的是Java HighLevel Rest Client客户端API</p> <h2 id="_4-0-导入demo工程"><a href="#_4-0-导入demo工程" class="header-anchor">#</a> 4.0.导入Demo工程</h2> <h3 id="_4-0-1-导入数据"><a href="#_4-0-1-导入数据" class="header-anchor">#</a> 4.0.1.导入数据</h3> <p>首先导入课前资料提供的数据库数据：</p> <p><img src="assets/image-20210720220400297.png" alt="image-20210720220400297"></p> <p>数据结构如下：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>tb_hotel<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'酒店id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'酒店名称；例：7天酒店'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>address<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'酒店地址；例：航头路'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>price<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'酒店价格；例：329'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>score<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'酒店评分；例：45，就是4.5分'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>brand<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'酒店品牌；例：如家'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>city<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'所在城市；例：上海'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>star_name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'酒店星级，从低到高分别是：1星到5星，1钻到5钻'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>business<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'商圈；例：虹桥'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>latitude<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'纬度；例：31.2497'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>longitude<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'经度；例：120.3925'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>pic<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'酒店图片；例:/img/1.jpg'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_4-0-2-导入项目"><a href="#_4-0-2-导入项目" class="header-anchor">#</a> 4.0.2.导入项目</h3> <p>然后导入课前资料提供的项目:</p> <p><img src="assets/image-20210720220503411.png" alt="image-20210720220503411"></p> <p>项目结构如图：</p> <p><img src="assets/image-20210720220647541.png" alt="image-20210720220647541"></p> <h3 id="_4-0-3-mapping映射分析"><a href="#_4-0-3-mapping映射分析" class="header-anchor">#</a> 4.0.3.mapping映射分析</h3> <p>创建索引库，最关键的是mapping映射，而mapping映射要考虑的信息包括：</p> <ul><li>字段名</li> <li>字段数据类型</li> <li>是否参与搜索</li> <li>是否需要分词</li> <li>如果分词，分词器是什么？</li></ul> <p>其中：</p> <ul><li>字段名、字段数据类型，可以参考数据表结构的名称和类型</li> <li>是否参与搜索要分析业务来判断，例如图片地址，就无需参与搜索</li> <li>是否分词呢要看内容，内容如果是一个整体就无需分词，反之则要分词</li> <li>分词器，我们可以统一使用ik_max_word</li></ul> <p>来看下酒店数据的索引库结构:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>PUT /hotel
<span class="token punctuation">{</span>
  <span class="token property">&quot;mappings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;copy_to&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;address&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;price&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;integer&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;score&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;integer&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;brand&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;copy_to&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;city&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;copy_to&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;starName&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;business&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;location&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;geo_point&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;pic&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;all&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_max_word&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>几个特殊字段说明：</p> <ul><li>location：地理坐标，里面包含精度、纬度</li> <li>all：一个组合字段，其目的是将多字段的值 利用copy_to合并，提供给用户搜索</li></ul> <p>地理坐标说明：</p> <p><img src="assets/image-20210720222110126.png" alt="image-20210720222110126"></p> <p>copy_to说明：</p> <p><img src="assets/image-20210720222221516.png" alt="image-20210720222221516"></p> <h3 id="_4-0-4-初始化restclient"><a href="#_4-0-4-初始化restclient" class="header-anchor">#</a> 4.0.4.初始化RestClient</h3> <p>在elasticsearch提供的API中，与elasticsearch一切交互都封装在一个名为RestHighLevelClient的类中，必须先完成这个对象的初始化，建立与elasticsearch的连接。</p> <p>分为三步：</p> <p>1）引入es的RestHighLevelClient依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.elasticsearch.client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>elasticsearch-rest-high-level-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>2）因为SpringBoot默认的ES版本是7.6.2，所以我们需要覆盖默认的ES版本：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elasticsearch.version</span><span class="token punctuation">&gt;</span></span>7.12.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elasticsearch.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>3）初始化RestHighLevelClient：</p> <p>初始化的代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">RestHighLevelClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span><span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>
        <span class="token class-name">HttpHost</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;http://192.168.150.101:9200&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这里为了单元测试方便，我们创建一个测试类HotelIndexTest，然后将初始化的代码编写在@BeforeEach方法中：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>hotel</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpHost</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestHighLevelClient</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">AfterEach</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">BeforeEach</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HotelIndexTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">RestHighLevelClient</span> client<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@BeforeEach</span>
    <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span><span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>
                <span class="token class-name">HttpHost</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;http://192.168.150.101:9200&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@AfterEach</span>
    <span class="token keyword">void</span> <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="_4-1-创建索引库"><a href="#_4-1-创建索引库" class="header-anchor">#</a> 4.1.创建索引库</h2> <h3 id="_4-1-1-代码解读"><a href="#_4-1-1-代码解读" class="header-anchor">#</a> 4.1.1.代码解读</h3> <p>创建索引库的API如下：</p> <p><img src="assets/image-20210720223049408.png" alt="image-20210720223049408"></p> <p>代码分为三步：</p> <ul><li>1）创建Request对象。因为是创建索引库的操作，因此Request是CreateIndexRequest。</li> <li>2）添加请求参数，其实就是DSL的JSON参数部分。因为json字符串很长，这里是定义了静态字符串常量MAPPING_TEMPLATE，让代码看起来更加优雅。</li> <li>3）发送请求，client.indices()方法的返回值是IndicesClient类型，封装了所有与索引库操作有关的方法。</li></ul> <h3 id="_4-1-2-完整示例"><a href="#_4-1-2-完整示例" class="header-anchor">#</a> 4.1.2.完整示例</h3> <p>在hotel-demo的cn.itcast.hotel.constants包下，创建一个类，定义mapping映射的JSON字符串常量：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>hotel<span class="token punctuation">.</span>constants</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HotelConstants</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> MAPPING_TEMPLATE <span class="token operator">=</span> <span class="token string">&quot;{\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;  \&quot;mappings\&quot;: {\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    \&quot;properties\&quot;: {\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;id\&quot;: {\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      },\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;name\&quot;:{\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;type\&quot;: \&quot;text\&quot;,\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;analyzer\&quot;: \&quot;ik_max_word\&quot;,\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;copy_to\&quot;: \&quot;all\&quot;\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      },\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;address\&quot;:{\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;index\&quot;: false\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      },\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;price\&quot;:{\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;type\&quot;: \&quot;integer\&quot;\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      },\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;score\&quot;:{\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;type\&quot;: \&quot;integer\&quot;\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      },\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;brand\&quot;:{\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;copy_to\&quot;: \&quot;all\&quot;\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      },\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;city\&quot;:{\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;copy_to\&quot;: \&quot;all\&quot;\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      },\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;starName\&quot;:{\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      },\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;business\&quot;:{\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      },\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;location\&quot;:{\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;type\&quot;: \&quot;geo_point\&quot;\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      },\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;pic\&quot;:{\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;index\&quot;: false\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      },\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;all\&quot;:{\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;type\&quot;: \&quot;text\&quot;,\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;analyzer\&quot;: \&quot;ik_max_word\&quot;\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      }\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    }\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;  }\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;}&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p>在hotel-demo中的HotelIndexTest测试类中，编写单元测试，实现创建索引：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">createHotelIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.创建Request对象</span>
    <span class="token class-name">CreateIndexRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateIndexRequest</span><span class="token punctuation">(</span><span class="token string">&quot;hotel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.准备请求的参数：DSL语句</span>
    request<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>MAPPING_TEMPLATE<span class="token punctuation">,</span> <span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3.发送请求</span>
    client<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="_4-2-删除索引库"><a href="#_4-2-删除索引库" class="header-anchor">#</a> 4.2.删除索引库</h2> <p>删除索引库的DSL语句非常简单：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>DELETE /hotel
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>与创建索引库相比：</p> <ul><li>请求方式从PUT变为DELTE</li> <li>请求路径不变</li> <li>无请求参数</li></ul> <p>所以代码的差异，注意体现在Request对象上。依然是三步走：</p> <ul><li>1）创建Request对象。这次是DeleteIndexRequest对象</li> <li>2）准备参数。这里是无参</li> <li>3）发送请求。改用delete方法</li></ul> <p>在hotel-demo中的HotelIndexTest测试类中，编写单元测试，实现删除索引：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">testDeleteHotelIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.创建Request对象</span>
    <span class="token class-name">DeleteIndexRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeleteIndexRequest</span><span class="token punctuation">(</span><span class="token string">&quot;hotel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.发送请求</span>
    client<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_4-3-判断索引库是否存在"><a href="#_4-3-判断索引库是否存在" class="header-anchor">#</a> 4.3.判断索引库是否存在</h2> <p>判断索引库是否存在，本质就是查询，对应的DSL是：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET /hotel
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>因此与删除的Java代码流程是类似的。依然是三步走：</p> <ul><li>1）创建Request对象。这次是GetIndexRequest对象</li> <li>2）准备参数。这里是无参</li> <li>3）发送请求。改用exists方法</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">testExistsHotelIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.创建Request对象</span>
    <span class="token class-name">GetIndexRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetIndexRequest</span><span class="token punctuation">(</span><span class="token string">&quot;hotel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.发送请求</span>
    <span class="token keyword">boolean</span> exists <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3.输出</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>exists <span class="token operator">?</span> <span class="token string">&quot;索引库已经存在！&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;索引库不存在！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="_4-4-总结"><a href="#_4-4-总结" class="header-anchor">#</a> 4.4.总结</h2> <p>JavaRestClient操作elasticsearch的流程基本类似。核心是client.indices()方法来获取索引库的操作对象。</p> <p>索引库操作的基本步骤：</p> <ul><li>初始化RestHighLevelClient</li> <li>创建XxxIndexRequest。XXX是Create、Get、Delete</li> <li>准备DSL（ Create时需要，其它是无参）</li> <li>发送请求。调用RestHighLevelClient#indices().xxx()方法，xxx是create、exists、delete</li></ul> <h1 id="_5-restclient操作文档"><a href="#_5-restclient操作文档" class="header-anchor">#</a> 5.RestClient操作文档</h1> <p>为了与索引库操作分离，我们再次参加一个测试类，做两件事情：</p> <ul><li>初始化RestHighLevelClient</li> <li>我们的酒店数据在数据库，需要利用IHotelService去查询，所以注入这个接口</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>hotel</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>hotel<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Hotel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>hotel<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IHotelService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">AfterEach</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">BeforeEach</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HotelDocumentTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">IHotelService</span> hotelService<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">RestHighLevelClient</span> client<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@BeforeEach</span>
    <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span><span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>
                <span class="token class-name">HttpHost</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;http://192.168.150.101:9200&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@AfterEach</span>
    <span class="token keyword">void</span> <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h2 id="_5-1-新增文档"><a href="#_5-1-新增文档" class="header-anchor">#</a> 5.1.新增文档</h2> <p>我们要将数据库的酒店数据查询出来，写入elasticsearch中。</p> <h3 id="_5-1-1-索引库实体类"><a href="#_5-1-1-索引库实体类" class="header-anchor">#</a> 5.1.1.索引库实体类</h3> <p>数据库查询后的结果是一个Hotel类型的对象。结构如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;tb_hotel&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hotel</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>INPUT<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> price<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> score<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> brand<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> city<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> starName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> business<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> longitude<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> latitude<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> pic<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>与我们的索引库结构存在差异：</p> <ul><li>longitude和latitude需要合并为location</li></ul> <p>因此，我们需要定义一个新的类型，与索引库结构吻合：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>hotel<span class="token punctuation">.</span>pojo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HotelDoc</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> price<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> score<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> brand<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> city<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> starName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> business<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> location<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> pic<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">HotelDoc</span><span class="token punctuation">(</span><span class="token class-name">Hotel</span> hotel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>score <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>brand <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getBrand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>city <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>starName <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getStarName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>business <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getBusiness</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>location <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getLatitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> hotel<span class="token punctuation">.</span><span class="token function">getLongitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pic <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getPic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="_5-1-2-语法说明"><a href="#_5-1-2-语法说明" class="header-anchor">#</a> 5.1.2.语法说明</h3> <p>新增文档的DSL语句如下：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>POST /<span class="token punctuation">{</span>索引库名<span class="token punctuation">}</span>/_doc/<span class="token number">1</span>
<span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Jack&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">21</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>对应的java代码如图：</p> <p><img src="assets/image-20210720230027240.png" alt="image-20210720230027240"></p> <p>可以看到与创建索引库类似，同样是三步走：</p> <ul><li>1）创建Request对象</li> <li>2）准备请求参数，也就是DSL中的JSON文档</li> <li>3）发送请求</li></ul> <p>变化的地方在于，这里直接使用client.xxx()的API，不再需要client.indices()了。</p> <h3 id="_5-1-3-完整代码"><a href="#_5-1-3-完整代码" class="header-anchor">#</a> 5.1.3.完整代码</h3> <p>我们导入酒店数据，基本流程一致，但是需要考虑几点变化：</p> <ul><li>酒店数据来自于数据库，我们需要先查询出来，得到hotel对象</li> <li>hotel对象需要转为HotelDoc对象</li> <li>HotelDoc需要序列化为json格式</li></ul> <p>因此，代码整体步骤如下：</p> <ul><li>1）根据id查询酒店数据Hotel</li> <li>2）将Hotel封装为HotelDoc</li> <li>3）将HotelDoc序列化为JSON</li> <li>4）创建IndexRequest，指定索引库名和id</li> <li>5）准备请求参数，也就是JSON文档</li> <li>6）发送请求</li></ul> <p>在hotel-demo的HotelDocumentTest测试类中，编写单元测试：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">testAddDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.根据id查询酒店数据</span>
    <span class="token class-name">Hotel</span> hotel <span class="token operator">=</span> hotelService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token number">61083L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.转换为文档类型</span>
    <span class="token class-name">HotelDoc</span> hotelDoc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HotelDoc</span><span class="token punctuation">(</span>hotel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3.将HotelDoc转json</span>
    <span class="token class-name">String</span> json <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>hotelDoc<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 1.准备Request对象</span>
    <span class="token class-name">IndexRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IndexRequest</span><span class="token punctuation">(</span><span class="token string">&quot;hotel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>hotelDoc<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.准备Json文档</span>
    request<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> <span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3.发送请求</span>
    client<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="_5-2-查询文档"><a href="#_5-2-查询文档" class="header-anchor">#</a> 5.2.查询文档</h2> <h3 id="_5-2-1-语法说明"><a href="#_5-2-1-语法说明" class="header-anchor">#</a> 5.2.1.语法说明</h3> <p>查询的DSL语句如下：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET /hotel/_doc/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>非常简单，因此代码大概分两步：</p> <ul><li>准备Request对象</li> <li>发送请求</li></ul> <p>不过查询的目的是得到结果，解析为HotelDoc，因此难点是结果的解析。完整代码如下：</p> <p><img src="assets/image-20210720230811674.png" alt="image-20210720230811674"></p> <p>可以看到，结果是一个JSON，其中文档放在一个<code>_source</code>属性中，因此解析就是拿到<code>_source</code>，反序列化为Java对象即可。</p> <p>与之前类似，也是三步走：</p> <ul><li>1）准备Request对象。这次是查询，所以是GetRequest</li> <li>2）发送请求，得到结果。因为是查询，这里调用client.get()方法</li> <li>3）解析结果，就是对JSON做反序列化</li></ul> <h3 id="_5-2-2-完整代码"><a href="#_5-2-2-完整代码" class="header-anchor">#</a> 5.2.2.完整代码</h3> <p>在hotel-demo的HotelDocumentTest测试类中，编写单元测试：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">testGetDocumentById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.准备Request</span>
    <span class="token class-name">GetRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetRequest</span><span class="token punctuation">(</span><span class="token string">&quot;hotel&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;61082&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.发送请求，得到响应</span>
    <span class="token class-name">GetResponse</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3.解析响应结果</span>
    <span class="token class-name">String</span> json <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">HotelDoc</span> hotelDoc <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> <span class="token class-name">HotelDoc</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hotelDoc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="_5-3-删除文档"><a href="#_5-3-删除文档" class="header-anchor">#</a> 5.3.删除文档</h2> <p>删除的DSL为是这样的：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>DELETE /hotel/_doc/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>与查询相比，仅仅是请求方式从DELETE变成GET，可以想象Java代码应该依然是三步走：</p> <ul><li>1）准备Request对象，因为是删除，这次是DeleteRequest对象。要指定索引库名和id</li> <li>2）准备参数，无参</li> <li>3）发送请求。因为是删除，所以是client.delete()方法</li></ul> <p>在hotel-demo的HotelDocumentTest测试类中，编写单元测试：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">testDeleteDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.准备Request</span>
    <span class="token class-name">DeleteRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeleteRequest</span><span class="token punctuation">(</span><span class="token string">&quot;hotel&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;61083&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.发送请求</span>
    client<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_5-4-修改文档"><a href="#_5-4-修改文档" class="header-anchor">#</a> 5.4.修改文档</h2> <h3 id="_5-4-1-语法说明"><a href="#_5-4-1-语法说明" class="header-anchor">#</a> 5.4.1.语法说明</h3> <p>修改我们讲过两种方式：</p> <ul><li>全量修改：本质是先根据id删除，再新增</li> <li>增量修改：修改文档中的指定字段值</li></ul> <p>在RestClient的API中，全量修改与新增的API完全一致，判断依据是ID：</p> <ul><li>如果新增时，ID已经存在，则修改</li> <li>如果新增时，ID不存在，则新增</li></ul> <p>这里不再赘述，我们主要关注增量修改。</p> <p>代码示例如图：</p> <p><img src="assets/image-20210720231040875.png" alt="image-20210720231040875"></p> <p>与之前类似，也是三步走：</p> <ul><li>1）准备Request对象。这次是修改，所以是UpdateRequest</li> <li>2）准备参数。也就是JSON文档，里面包含要修改的字段</li> <li>3）更新文档。这里调用client.update()方法</li></ul> <h3 id="_5-4-2-完整代码"><a href="#_5-4-2-完整代码" class="header-anchor">#</a> 5.4.2.完整代码</h3> <p>在hotel-demo的HotelDocumentTest测试类中，编写单元测试：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">testUpdateDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.准备Request</span>
    <span class="token class-name">UpdateRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UpdateRequest</span><span class="token punctuation">(</span><span class="token string">&quot;hotel&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;61083&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.准备请求参数</span>
    request<span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>
        <span class="token string">&quot;price&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;952&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;starName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;四钻&quot;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3.发送请求</span>
    client<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="_5-5-批量导入文档"><a href="#_5-5-批量导入文档" class="header-anchor">#</a> 5.5.批量导入文档</h2> <p>案例需求：利用BulkRequest批量将数据库数据导入到索引库中。</p> <p>步骤如下：</p> <ul><li><p>利用mybatis-plus查询酒店数据</p></li> <li><p>将查询到的酒店数据（Hotel）转换为文档类型数据（HotelDoc）</p></li> <li><p>利用JavaRestClient中的BulkRequest批处理，实现批量新增文档</p></li></ul> <h3 id="_5-5-1-语法说明"><a href="#_5-5-1-语法说明" class="header-anchor">#</a> 5.5.1.语法说明</h3> <p>批量处理BulkRequest，其本质就是将多个普通的CRUD请求组合在一起发送。</p> <p>其中提供了一个add方法，用来添加其他请求：</p> <p><img src="assets/image-20210720232105943.png" alt="image-20210720232105943"></p> <p>可以看到，能添加的请求包括：</p> <ul><li>IndexRequest，也就是新增</li> <li>UpdateRequest，也就是修改</li> <li>DeleteRequest，也就是删除</li></ul> <p>因此Bulk中添加了多个IndexRequest，就是批量新增功能了。示例：</p> <p><img src="assets/image-20210720232431383.png" alt="image-20210720232431383"></p> <p>其实还是三步走：</p> <ul><li>1）创建Request对象。这里是BulkRequest</li> <li>2）准备参数。批处理的参数，就是其它Request对象，这里就是多个IndexRequest</li> <li>3）发起请求。这里是批处理，调用的方法为client.bulk()方法</li></ul> <p>我们在导入酒店数据时，将上述代码改造成for循环处理即可。</p> <h3 id="_5-5-2-完整代码"><a href="#_5-5-2-完整代码" class="header-anchor">#</a> 5.5.2.完整代码</h3> <p>在hotel-demo的HotelDocumentTest测试类中，编写单元测试：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">testBulkRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 批量查询酒店数据</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Hotel</span><span class="token punctuation">&gt;</span></span> hotels <span class="token operator">=</span> hotelService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 1.创建Request</span>
    <span class="token class-name">BulkRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BulkRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.准备参数，添加多个新增的Request</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Hotel</span> hotel <span class="token operator">:</span> hotels<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 2.1.转换为文档类型HotelDoc</span>
        <span class="token class-name">HotelDoc</span> hotelDoc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HotelDoc</span><span class="token punctuation">(</span>hotel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.2.创建新增文档的Request对象</span>
        request<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IndexRequest</span><span class="token punctuation">(</span><span class="token string">&quot;hotel&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>hotelDoc<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>hotelDoc<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 3.发送请求</span>
    client<span class="token punctuation">.</span><span class="token function">bulk</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="_5-6-小结"><a href="#_5-6-小结" class="header-anchor">#</a> 5.6.小结</h2> <p>文档操作的基本步骤：</p> <ul><li>初始化RestHighLevelClient</li> <li>创建XxxRequest。XXX是Index、Get、Update、Delete、Bulk</li> <li>准备参数（Index、Update、Bulk时需要）</li> <li>发送请求。调用RestHighLevelClient#.xxx()方法，xxx是index、get、update、delete、bulk</li> <li>解析结果（Get时需要）</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/8/24 下午11:35:49</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zh/DevAdvance/MicroServiceSkill/MQ/RabbitMQ.html" class="prev">
        RabbitMQ
      </a></span> <span class="next"><a href="/zh/DevAdvance/MicroServiceSkill/Elasticsearch02/分布式搜索引擎02.html">
        分布式搜索引擎02
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a0a6ba19.js" defer></script><script src="/assets/js/4.900969d6.js" defer></script><script src="/assets/js/201.035e7d0f.js" defer></script>
  </body>
</html>
